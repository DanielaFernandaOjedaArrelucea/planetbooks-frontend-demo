<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reporte de Clientes - PlanetBooksAdmin</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

</head>

<body>
    <div class="container-fluid">
        <div class="row">

            <div th:insert="fragments/sidebar :: Sidebar"></div>

            <main class="px-md-4 main-content">

                <div class="d-flex justify-content-between align-items-center flex-wrap flex-md-nowrap pt-3 pb-2 mb-4 border-bottom">
                    <h2 class="h2 fw-bold text-balance">
                        <svg class="bi me-2" width="32" height="32" fill="currentColor">
                            <use xlink:href="#graph-up"/>
                        </svg>
                        Reporte de Comportamiento de Clientes
                    </h2>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button type="button" class="btn btn-sm btn-info text-white rounded-pill shadow-sm me-2">
                            <i class="bi bi-download me-1"></i> Exportar a PDF
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary rounded-pill shadow-sm">
                            <i class="bi bi-calendar-range me-1"></i> Definir Período
                        </button>
                    </div>
                </div>

                <div th:replace="fragments/reportes-tabs :: tabs('clientes')"></div>

                <div id="clientes-content" class="tab-pane-content">

                    <div class="card shadow-lg mb-5 rounded-3 border-0">
                        <div class="card-header bg-white fw-bold border-bottom-0 d-flex align-items-center p-4">
                            <i class="bi bi-funnel-fill me-2 text-primary fs-5"></i>
                            Filtros de Segmentación y Tiempo
                        </div>
                        <div class="card-body p-4">
                            <div class="row g-3 align-items-end">

                                <div class="col-md-4 col-lg-3">
                                    <label for="tipoCliente" class="form-label text-muted small mb-1">Tipo de Cliente</label>
                                    <select class="form-select rounded-pill" id="tipoCliente">
                                        <option selected>Todos</option>
                                        <option value="1">Clientes Nuevos</option>
                                        <option value="2">Clientes Leales</option>
                                        <option value="3">Clientes en Riesgo</option>
                                    </select>
                                </div>

                                <div class="col-md-4 col-lg-3">
                                    <label for="categoriaInteres" class="form-label text-muted small mb-1">Categoría Principal</label>
                                    <select class="form-select rounded-pill" id="categoriaInteres">
                                        <option selected>Todas las Certificaciones</option>
                                        <option value="1">TOEFL</option>
                                        <option value="2">IELTS</option>
                                        <option value="3">GMAT/GRE</option>
                                        <option value="4">Inglés de Negocios</option>
                                    </select>
                                </div>

                                <div class="col-md-4 col-lg-3">
                                    <label for="fechaFinClientes" class="form-label text-muted small mb-1">Periodo de Análisis</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control rounded-start-pill" id="fechaFinClientes" placeholder="Últimos 120 días">
                                        <span class="input-group-text rounded-end-pill"><i class="bi bi-clock-history"></i></span>
                                    </div>
                                </div>

                                <div class="col-12 col-lg-3 d-flex justify-content-end justify-content-lg-start">
                                    <button type="button" class="btn btn-primary rounded-pill shadow-sm">
                                        <i class="bi bi-search me-1"></i> Aplicar Filtros
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h2 class="h4 mb-3 text-gray-700">Métricas Clave de Activación y Fidelización</h2>
                    <div class="row g-4 mb-6">

                        <div class="col-xl-3 col-md-6">
                            <div class="card text-white shadow-lg h-100 border-0 bg-primary bg-gradient">
                                <div class="card-body">
                                    <h5 class="card-title text-uppercase mb-2 fs-6 opacity-75">Tasa de Conversión</h5>
                                    <div class="h3 mb-0">9.5% <span class="badge bg-light text-primary ms-2">+1.2%</span></div>
                                    <small class="text-white opacity-75">De registro a compra</small>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6">
                            <div class="card text-white shadow-lg h-100 border-0 bg-danger bg-gradient">
                                <div class="card-body">
                                    <h5 class="card-title text-uppercase mb-2 fs-6 opacity-75">Clientes Inactivos</h5>
                                    <div class="h3 mb-0">1,890</div>
                                    <small class="text-white opacity-75">Sin compra en más de 90 días</small>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6">
                            <div class="card text-white shadow-lg h-100 border-0 bg-info bg-gradient">
                                <div class="card-body">
                                    <h5 class="card-title text-uppercase mb-2 fs-6 opacity-75">Valor de Vida Promedio (CLV)</h5>
                                    <div class="h3 mb-0">$115.70</div>
                                    <small class="text-white opacity-75">Gasto total esperado</small>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6">
                            <div class="card text-white shadow-lg h-100 border-0 bg-success bg-gradient">
                                <div class="card-body">
                                    <h5 class="card-title text-uppercase mb-2 fs-6 opacity-75">Frecuencia de Compra</h5>
                                    <div class="h3 mb-0">2.7 Libros / Año</div>
                                    <small class="text-white opacity-75">Promedio anual</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h2 class="h4 mt-3 mb-3 text-gray-700">Listado de Clientes en Riesgo</h2>
                    <div class="card shadow-lg mb-4 rounded-3 border-0">
                        <div class="card-header bg-warning-subtle text-warning-emphasis fw-bold">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i> Clientes sin compra en los últimos 90 días
                        </div>
                        <div class="card-body p-4">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-sm align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th>ID Cliente</th>
                                            <th>Nombre</th>
                                            <th>Última Compra (Días)</th>
                                            <th>Gasto Total (CLV)</th>
                                            <th>Interés Principal</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="cliente : ${clientes}">
                                            <td th:text="${cliente.id}">C-100</td>
                                            <td th:text="${cliente.nombre}">Marco P.</td>
                                            <td th:text="${cliente.diasUltimaCompra}">105 días</td>
                                            <td th:text="${cliente.gastoTotal}">$25.00</td>
                                            <td th:text="${cliente.interes}">TOEFL Prep</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-info rounded-pill">
                                                    Reactivar
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
